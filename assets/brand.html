
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vitalo - Kinetic Warmth</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts: Outfit (Headings) & Plus Jakarta Sans (Body) -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&family=Plus+Jakarta+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        bg: {
                            base: 'var(--bg-base)',
                            card: 'var(--bg-card)', 
                            subtle: 'var(--bg-subtle)',
                        },
                        brand: {
                            primary: 'var(--brand-primary)',
                            secondary: 'var(--brand-secondary)',
                            tertiary: 'var(--brand-tertiary)',
                            accent: 'var(--brand-accent)',
                            text: 'var(--text-main)',
                            muted: 'var(--text-muted)',
                        },
                        solar: {
                            orange: '#F97316',
                            gold: '#F59E0B',
                            rose: '#E11D48',
                        },
                        lunar: {
                            indigo: '#4F46E5',
                            violet: '#8B5CF6',
                            navy: '#1E1B4B',
                        }
                    },
                    fontFamily: {
                        display: ['Outfit', 'sans-serif'],
                        body: ['Plus Jakarta Sans', 'sans-serif'],
                    },
                    boxShadow: {
                        'matte-sm': '0 2px 8px rgba(0,0,0,0.08)',
                        'matte-lg': '0 10px 30px -5px rgba(0,0,0,0.12)',
                        'glow-solar': '0 0 20px rgba(249, 115, 22, 0.3)',
                        'glow-lunar': '0 0 20px rgba(79, 70, 229, 0.3)',
                    },
                    animation: {
                        'float-slow': 'float 8s ease-in-out infinite',
                        'float-med': 'float 6s ease-in-out infinite',
                        'spin-slow': 'spin 15s linear infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            /* Light Mode: Warm Stone (Solar Default) */
            --bg-base: #F5F5F4; /* Stone 100 */
            --bg-card: #FFFFFF;
            --bg-subtle: #E7E5E4; /* Stone 200 */
            
            --brand-primary: #F97316; /* Solar Orange */
            --brand-secondary: #F59E0B; /* Gold */
            --brand-tertiary: #4F46E5; /* Indigo */
            --brand-accent: #E11D48; /* Rose */
            
            --text-main: #1C1917; /* Stone 900 */
            --text-muted: #78716C; /* Stone 500 */
        }
        .dark {
            /* Dark Mode: Deep Gunmetal (Lunar Default) */
            --bg-base: #0F172A; /* Slate 900 */
            --bg-card: #1E293B; /* Slate 800 */
            --bg-subtle: #334155; /* Slate 700 */
            
            --brand-primary: #818CF8; /* Indigo 400 */
            --brand-secondary: #A78BFA; /* Violet 400 */
            --brand-tertiary: #F97316; /* Orange */
            --brand-accent: #34D399; /* Emerald */
            
            --text-main: #F8FAFC; /* Slate 50 */
            --text-muted: #94A3B8; /* Slate 400 */
        }
        body { 
            background-color: var(--bg-base); 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            color: var(--text-main); 
            transition: background-color 0.4s ease, color 0.4s ease; 
        }
        
        .mobile-container {
            max-width: 400px;
            margin: 0 auto;
            background-color: var(--bg-base);
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 60px rgba(0,0,0,0.1);
            overflow-x: hidden;
            transition: background-color 0.4s ease;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        /* Gradient Text */
        .text-gradient-solar { background: linear-gradient(135deg, #F97316, #BE123C); -webkit-background-clip: text; color: transparent; }
        .text-gradient-lunar { background: linear-gradient(135deg, #818CF8, #C084FC); -webkit-background-clip: text; color: transparent; }
        /* Matte Card */
        .card-matte {
            background-color: var(--bg-card);
            border-radius: 24px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .card-matte:active { transform: scale(0.98); }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const apiKey = ""; 
        // --- GEMINI API HELPER ---
        const callGemini = async (prompt, systemInstruction) => {
            if (!apiKey) return new Promise(resolve => setTimeout(() => resolve("AI: Systems aligned. Insight generated."), 1000));
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: systemInstruction }] }
                    })
                });
                if (!response.ok) throw new Error('API Call Failed');
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "Processing...";
            } catch (error) {
                return "Connection unavailable.";
            }
        };
        // --- Icons ---
        const IconBase = ({ children, size = 22, className = "", ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Icons = {
            Activity: (props) => <IconBase {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></IconBase>,
            Moon: (props) => <IconBase {...props}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></IconBase>,
            User: (props) => <IconBase {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>,
            Trophy: (props) => <IconBase {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M2 2h20"/><path d="M8 22v-3a3 3 0 0 1 3-3h2a3 3 0 0 1 3 3v3"/><path d="M12 2v10a3 3 0 0 0 3 3h0a3 3 0 0 0 3-3V2"/></IconBase>,
            ChevronRight: (props) => <IconBase {...props}><path d="m9 18 6-6-6-6"/></IconBase>,
            Upload: (props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></IconBase>,
            TrendingUp: (props) => <IconBase {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></IconBase>,
            Brain: (props) => <IconBase {...props}><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></IconBase>,
            Zap: (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>,
            Home: (props) => <IconBase {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></IconBase>,
            Utensils: (props) => <IconBase {...props}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></IconBase>,
            Sparkles: (props) => <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></IconBase>,
            X: (props) => <IconBase {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>,
            Sun: (props) => <IconBase {...props}><circle cx="12" cy="12" r="5"/><path d="M12 1v2"/><path d="M12 21v2"/><path d="M4.22 4.22l1.42 1.42"/><path d="M18.36 18.36l1.42 1.42"/><path d="M1 12h2"/><path d="M21 12h2"/><path d="M4.22 19.78l1.42-1.42"/><path d="M18.36 5.64l1.42-1.42"/></IconBase>,
            Layers: (props) => <IconBase {...props}><polygon points="12 2 2 7 12 12 22 7 12 2" /><polyline points="2 17 12 22 22 17" /><polyline points="2 12 12 17 22 12" /></IconBase>
        };
        const { Activity, Moon, User, Trophy, ChevronRight, Upload, TrendingUp, Brain, Zap, Home, Utensils, Sparkles, X, Sun, Layers } = Icons;
        // --- LAYERED MASCOT: "THE FLUX" ---
        // 3 Independent layers. Changes colors based on Theme (Solar/Lunar).
        // Represents depth of health (Physical, Nutritional, Mental).
        const FluxMascot = ({ themeMode = 'light' }) => {
            
            const config = {
                solar: { // Warm, Energetic, Sunset
                    back: '#FDBA74', // Orange-300
                    mid: '#F97316',  // Orange-500
                    front: '#EA580C', // Orange-600
                    glow: 'rgba(249, 115, 22, 0.4)'
                },
                lunar: { // Cool, Calm, Deep Space
                    back: '#818CF8', // Indigo-400
                    mid: '#6366F1',  // Indigo-500
                    front: '#4338CA', // Indigo-700
                    glow: 'rgba(99, 102, 241, 0.4)'
                }
            };
            const t = themeMode === 'light' ? config.solar : config.lunar;
            return (
                <div className="relative w-56 h-56 mx-auto flex items-center justify-center">
                    
                    {/* Layer 1: The Aura (Back) - Slow Rotation */}
                    <div className="absolute w-48 h-48 animate-spin-slow opacity-40">
                        <svg viewBox="0 0 100 100" className="w-full h-full">
                            <path d="M50 0 C80 0 100 20 100 50 C100 80 80 100 50 100 C20 100 0 80 0 50 C0 20 20 0 50 0 Z" fill={t.back} transform="scale(0.9)" />
                        </svg>
                    </div>
                    {/* Layer 2: The Flow (Middle) - Floating */}
                    <div className="absolute w-40 h-40 animate-float-med opacity-80">
                        <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-lg">
                            <path d="M50 10 Q90 10 90 50 Q90 90 50 90 Q10 90 10 50 Q10 10 50 10 Z" fill={t.mid} />
                        </svg>
                    </div>
                    {/* Layer 3: The Core (Front) - Pulsing */}
                    <div className="absolute w-24 h-24 animate-float-slow z-10">
                        <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-2xl" style={{ filter: `drop-shadow(0 0 25px ${t.glow})` }}>
                            <circle cx="50" cy="50" r="40" fill={t.front} />
                            {/* Shine */}
                            <ellipse cx="35" cy="35" rx="10" ry="5" fill="white" fillOpacity="0.3" transform="rotate(-45 35 35)" />
                        </svg>
                    </div>
                </div>
            );
        };
        // --- MAIN APP ---
        const VitaloApp = () => {
            const [screen, setScreen] = useState('auth');
            const [activeTab, setActiveTab] = useState('dashboard');
            const [darkMode, setDarkMode] = useState(false); // Default to Solar (Light)
            
            const [userState, setUserState] = useState({
                name: "Alex",
                coins: 850,
                healthScore: 88,
            });
            const [motivation, setMotivation] = useState("");
            const [loadingMot, setLoadingMot] = useState(false);
            const generateMotivation = async () => {
                setLoadingMot(true);
                const prompt = "Give me a deep, grounded motivation quote. 10 words max. Tone: Sage/Mentor.";
                const system = "You are Vitalo, a sophisticated health AI.";
                const text = await callGemini(prompt, system);
                setMotivation(text);
                setLoadingMot(false);
            };
            const toggleTheme = () => setDarkMode(!darkMode);
            return (
                <div className={`mobile-container flex flex-col font-body ${darkMode ? 'dark' : ''}`}>
                    
                    {/* Controls */}
                    <div className="absolute top-6 right-6 z-50 flex gap-3">
                        <button onClick={toggleTheme} className="bg-bg-card p-3 rounded-full shadow-matte-sm text-brand-muted hover:text-brand-primary transition-colors">
                            {darkMode ? <Sun size={20} /> : <Moon size={20} />}
                        </button>
                    </div>
                    {screen === 'auth' && <AuthScreen onLogin={() => setScreen('onboarding')} darkMode={darkMode} />}
                    {screen === 'onboarding' && <OnboardingScreen onComplete={() => setScreen('main')} darkMode={darkMode} />}
                    {screen === 'main' && (
                        <>
                            <div className="flex-1 overflow-y-scroll no-scrollbar pb-28 bg-bg-base">
                                {activeTab === 'dashboard' && <Dashboard user={userState} setUser={setUserState} motivation={motivation} loadingMot={loadingMot} onGenMot={generateMotivation} darkMode={darkMode} />}
                                {activeTab === 'coach' && <AICoach user={userState} />}
                                {activeTab === 'health' && <HealthData />}
                            </div>
                            <BottomNav activeTab={activeTab} setActiveTab={setActiveTab} />
                        </>
                    )}
                </div>
            );
        };
        // --- 1. Auth ---
        const AuthScreen = ({ onLogin, darkMode }) => (
            <div className="flex flex-col items-center justify-center h-full p-8 bg-bg-base">
                <div className="mb-10 scale-125">
                    <FluxMascot themeMode={darkMode ? 'dark' : 'light'} />
                </div>
                
                <h1 className={`font-display text-5xl font-extrabold mb-3 tracking-tight ${darkMode ? 'text-gradient-lunar' : 'text-gradient-solar'}`}>
                    Vitalo.
                </h1>
                <p className="text-center mb-16 text-brand-muted font-medium text-lg max-w-[240px] leading-relaxed">
                    Your vitality, layered and living.
                </p>
                
                <div className="w-full space-y-4">
                    <button onClick={onLogin} className="w-full bg-brand-primary text-white font-bold py-4 rounded-2xl shadow-glow-solar dark:shadow-glow-lunar active:scale-95 transition-all">
                        Begin Journey
                    </button>
                    <button onClick={onLogin} className="w-full bg-bg-card text-brand-text font-bold py-4 rounded-2xl shadow-matte-sm active:scale-95 transition-all">
                        Log In
                    </button>
                </div>
            </div>
        );
        // --- 2. Onboarding ---
        const OnboardingScreen = ({ onComplete, darkMode }) => {
            const [step, setStep] = useState(0);
            const handleNext = () => { if(step < 2) setStep(step + 1); else onComplete(); };
            return (
                <div className="flex flex-col h-full bg-bg-base p-6 pt-12">
                    <div className="flex-1 w-full max-w-sm mx-auto">
                        {/* Progress */}
                        <div className="w-full h-1.5 bg-bg-subtle rounded-full mb-12 overflow-hidden">
                            <div className="h-full bg-brand-primary transition-all duration-500 ease-out" style={{width: `${((step + 1) / 3) * 100}%`}}></div>
                        </div>
                        <div className="flex justify-start mb-6">
                            <div className="w-16 h-16 bg-bg-card rounded-full flex items-center justify-center shadow-matte-sm">
                                <div className="scale-[0.4]"><FluxMascot themeMode={darkMode ? 'dark' : 'light'} /></div>
                            </div>
                        </div>
                        <h2 className="font-display text-4xl font-bold text-brand-text mb-3 leading-tight">
                            {step === 0 && "Primary Focus"}
                            {step === 1 && "Energy Level"}
                            {step === 2 && "Nutrition Style"}
                        </h2>
                        
                        <div className="space-y-4 mt-10">
                            {step === 0 && ['Peak Vitality (18-26)', 'Sustainable Balance', 'Deep Focus', 'Physical Strength'].map(opt => (
                                <OptionBtn key={opt} text={opt} onClick={handleNext} />
                            ))}
                            {step === 1 && ['High (Solar)', 'Moderate', 'Low (Lunar)'].map(opt => (
                                <OptionBtn key={opt} text={opt} onClick={handleNext} />
                            ))}
                             {step === 2 && ['No Restrictions', 'Plant-Based', 'High Protein', 'Keto'].map(opt => (
                                <OptionBtn key={opt} text={opt} onClick={handleNext} />
                            ))}
                        </div>
                    </div>
                </div>
            );
        };
        const OptionBtn = ({ text, onClick }) => (
            <button onClick={onClick} className="w-full text-left p-5 rounded-2xl bg-bg-card shadow-matte-sm hover:shadow-matte-lg transition-all font-bold text-brand-text flex justify-between items-center group border border-transparent hover:border-brand-primary">
                {text}
                <div className="w-8 h-8 rounded-full bg-bg-subtle flex items-center justify-center group-hover:bg-brand-primary group-hover:text-white transition-colors">
                    <ChevronRight size={18} />
                </div>
            </button>
        );
        // --- 3. Dashboard ---
        const Dashboard = ({ user, setUser, motivation, loadingMot, onGenMot, darkMode }) => {
            const [showRecipeModal, setShowRecipeModal] = useState(false);
            return (
                <div className="p-6 pt-8">
                    {/* Header */}
                    <div className="flex justify-between items-center mb-8">
                        <div>
                            <div className="text-xs font-bold text-brand-muted uppercase tracking-widest mb-1">Today's Flux</div>
                            <span className="font-display text-3xl font-bold text-brand-text">{user.name}</span>
                        </div>
                        <div className="flex items-center gap-2 bg-bg-card px-4 py-2 rounded-full shadow-matte-sm">
                            <Trophy size={16} className="text-brand-secondary" />
                            <span className="font-bold text-brand-text text-sm">{user.coins}</span>
                        </div>
                    </div>
                    {/* HERO CARD - Immersive Art */}
                    <div className="w-full bg-bg-card rounded-[32px] p-8 mb-8 relative overflow-hidden shadow-matte-lg border border-bg-subtle">
                        {/* Ambient Glows */}
                        <div className="absolute top-0 right-0 w-40 h-40 bg-brand-primary opacity-10 rounded-full blur-3xl -mr-10 -mt-10"></div>
                        <div className="absolute bottom-0 left-0 w-40 h-40 bg-brand-tertiary opacity-10 rounded-full blur-3xl -ml-10 -mb-10"></div>
                        <div className="flex flex-col items-center relative z-10">
                            <FluxMascot themeMode={darkMode ? 'dark' : 'light'} />
                            
                            <div className="text-center mt-6">
                                <div className="text-6xl font-display font-bold text-brand-text tracking-tight">{user.healthScore}</div>
                                <div className="text-xs font-bold text-brand-muted uppercase tracking-widest mt-2">Vitality Index</div>
                            </div>
                        </div>
                        
                        <div className="mt-8 flex justify-center">
                            <button onClick={onGenMot} className="flex items-center gap-2 text-brand-muted hover:text-brand-primary transition-colors text-sm font-medium bg-bg-subtle px-5 py-2.5 rounded-full shadow-sm">
                                <Sparkles size={14} />
                                <span>{loadingMot ? "Aligning..." : (motivation || "Tap for insight.")}</span>
                            </button>
                        </div>
                    </div>
                    {/* Horizontal Action Deck */}
                    <h3 className="font-display text-lg font-bold text-brand-text mb-4 pl-2">Action Deck</h3>
                    <div className="flex gap-4 overflow-x-auto pb-4 snap-x snap-mandatory no-scrollbar">
                         <DeckCard 
                            icon={TrendingUp} 
                            title="Motion" 
                            subtitle="8,432 Steps" 
                            color="text-brand-primary"
                            bg="bg-orange-50 dark:bg-orange-900/20"
                            onClick={() => setUser(p => ({...p, coins: p.coins + 10}))}
                        />
                         <DeckCard 
                            icon={Utensils} 
                            title="Fuel" 
                            subtitle="AI Meal Plan" 
                            color="text-brand-tertiary"
                            bg="bg-rose-50 dark:bg-rose-900/20"
                            onClick={() => setShowRecipeModal(true)}
                        />
                        <DeckCard 
                            icon={Moon} 
                            title="Rest" 
                            subtitle="Log Sleep" 
                            color="text-brand-tertiary"
                            bg="bg-indigo-50 dark:bg-indigo-900/20"
                            onClick={() => {}}
                        />
                    </div>
                    {showRecipeModal && <RecipeGenerator onClose={() => setShowRecipeModal(false)} />}
                </div>
            );
        };
        const DeckCard = ({ icon: Icon, title, subtitle, color, bg, onClick }) => (
            <button onClick={onClick} className="min-w-[160px] h-[200px] bg-bg-card rounded-[24px] p-6 text-left shadow-matte-sm hover:shadow-matte-lg transition-all snap-start flex flex-col justify-between active:scale-95 border border-bg-subtle">
                <div className={`w-12 h-12 rounded-2xl flex items-center justify-center ${bg} ${color}`}>
                    <Icon size={24} />
                </div>
                <div>
                    <div className="font-display font-bold text-2xl text-brand-text">{title}</div>
                    <div className="text-xs text-brand-muted font-medium mt-1">{subtitle}</div>
                </div>
            </button>
        );
        // --- AI FEATURES ---
        const RecipeGenerator = ({ onClose }) => {
            const [ingredients, setIngredients] = useState("");
            const [recipe, setRecipe] = useState("");
            const [loading, setLoading] = useState(false);
            const handleGenerate = async () => {
                if(!ingredients) return;
                setLoading(true);
                const prompt = `Create a solid, nutritious recipe with: ${ingredients}. Short format.`;
                const system = "You are a modern chef.";
                const result = await callGemini(prompt, system);
                setRecipe(result);
                setLoading(false);
            };
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-6 bg-bg-base/90 backdrop-blur-sm">
                    <div className="bg-bg-card w-full max-w-sm rounded-[32px] p-8 relative shadow-matte-lg border border-bg-subtle">
                        <button onClick={onClose} className="absolute top-6 right-6 p-2 bg-bg-base rounded-full text-brand-muted hover:text-brand-text"><X size={20}/></button>
                        
                        <div className="w-14 h-14 bg-bg-subtle rounded-full flex items-center justify-center mb-6 text-brand-primary">
                            <Utensils size={28} />
                        </div>
                        
                        <h3 className="font-display text-2xl font-bold text-brand-text mb-2">Fuel AI</h3>
                        <p className="text-sm text-brand-muted mb-8">What ingredients are available?</p>
                        
                        {!recipe ? (
                            <>
                                <textarea 
                                    className="w-full bg-bg-base border border-bg-subtle rounded-2xl p-4 text-sm focus:outline-none focus:ring-2 focus:ring-brand-primary mb-6 h-28 text-brand-text placeholder-brand-muted resize-none"
                                    placeholder="e.g. Quinoa, Kale, Chickpeas..."
                                    value={ingredients}
                                    onChange={e => setIngredients(e.target.value)}
                                />
                                <button onClick={handleGenerate} disabled={loading} className="w-full bg-brand-primary text-white font-bold py-4 rounded-2xl hover:opacity-90 active:scale-95 transition-all flex justify-center items-center gap-2">
                                    {loading ? "Processing..." : "Generate Meal"}
                                </button>
                            </>
                        ) : (
                            <div className="bg-bg-base rounded-2xl p-5 max-h-[300px] overflow-y-auto text-sm leading-relaxed text-brand-text border border-bg-subtle">
                                <div className="whitespace-pre-wrap">{recipe}</div>
                                <button onClick={() => setRecipe("")} className="mt-6 text-xs font-bold text-brand-primary uppercase tracking-wide w-full text-center">Start Over</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };
        const AICoach = ({ user }) => {
            const [input, setInput] = useState('');
            const [messages, setMessages] = useState([
                { id: 1, sender: 'bot', text: `Flux State: Stable. How can I assist?` }
            ]);
            const [loading, setLoading] = useState(false);
            const scrollRef = useRef(null);
            useEffect(() => {
                if (scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
            }, [messages, loading]);
            const sendMessage = async () => {
                if(!input.trim()) return;
                const userMsg = { id: Date.now(), sender: 'user', text: input };
                setMessages(prev => [...prev, userMsg]);
                setInput('');
                setLoading(true);
                const prompt = `User: ${input}. Context: Score ${user.healthScore}.`;
                const system = "You are Vitalo, a grounded, smart health AI.";
                const replyText = await callGemini(prompt, system);
                
                setLoading(false);
                setMessages(prev => [...prev, { id: Date.now()+1, sender: 'bot', text: replyText }]);
            };
            return (
                <div className="flex flex-col h-full bg-bg-base">
                     <div className="bg-bg-card px-6 py-4 shadow-sm sticky top-0 z-10 flex items-center gap-4 border-b border-bg-subtle">
                         <div className="w-10 h-10 rounded-full bg-bg-subtle flex items-center justify-center text-brand-primary">
                             <Brain size={20} />
                        </div>
                        <div>
                            <h3 className="font-display font-bold text-brand-text">Vitalo Coach</h3>
                            <div className="text-xs text-brand-accent font-bold flex items-center gap-1">
                                <span className="w-1.5 h-1.5 bg-brand-accent rounded-full animate-pulse"></span>
                                Online
                            </div>
                        </div>
                    </div>
                    <div className="flex-1 p-4 space-y-4 overflow-y-auto pb-28" ref={scrollRef}>
                        {messages.map(msg => (
                            <div key={msg.id} className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[85%] p-4 rounded-2xl text-sm font-medium leading-relaxed shadow-sm ${
                                    msg.sender === 'user' 
                                    ? 'bg-brand-primary text-white rounded-tr-sm' 
                                    : 'bg-bg-card text-brand-text border border-bg-subtle rounded-tl-sm'
                                }`}>
                                    {msg.text}
                                </div>
                            </div>
                        ))}
                        {loading && <div className="text-xs text-brand-muted ml-4 font-bold">Thinking...</div>}
                    </div>
                     <div className="p-4 fixed bottom-[90px] w-full max-w-[400px]">
                        <div className="flex gap-2 bg-bg-card p-2 rounded-3xl shadow-lg border border-bg-subtle">
                            <input 
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                onKeyDown={(e) => e.key === 'Enter' && sendMessage()}
                                placeholder="Ask anything..."
                                className="flex-1 bg-transparent border-none px-4 text-sm focus:ring-0 text-brand-text placeholder-brand-muted"
                            />
                            <button onClick={sendMessage} className="bg-brand-primary text-white p-3 rounded-full hover:opacity-90 active:scale-95 transition-transform">
                                <ChevronRight size={20} />
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        const HealthData = () => (
            <div className="p-6 pt-10">
                <h2 className="font-display text-2xl font-bold text-brand-text mb-6">Medical Data</h2>
                <div className="bg-bg-card p-8 rounded-[32px] text-center border border-bg-subtle shadow-matte-sm relative overflow-hidden">
                    <div className="w-16 h-16 bg-bg-subtle rounded-2xl flex items-center justify-center mx-auto mb-6 text-brand-primary rotate-3">
                        <Upload size={32} />
                    </div>
                    <h3 className="font-bold text-xl text-brand-text mb-2">Analyze Labs</h3>
                    <p className="text-sm text-brand-muted mb-8 leading-relaxed">Secure, on-device analysis of your medical documents. Data is ephemeral.</p>
                    <button className="w-full bg-bg-base border border-bg-subtle text-brand-text font-bold py-4 rounded-2xl hover:bg-bg-subtle transition-colors">
                        Select Document
                    </button>
                </div>
            </div>
        );
        // --- Nav ---
        const BottomNav = ({ activeTab, setActiveTab }) => (
            <div className="absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none">
                <div className="bg-bg-card px-8 py-4 rounded-full shadow-matte-lg border border-bg-subtle flex gap-10 pointer-events-auto">
                    <NavIcon icon={Home} active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} />
                    <NavIcon icon={Brain} active={activeTab === 'coach'} onClick={() => setActiveTab('coach')} />
                    <NavIcon icon={Activity} active={activeTab === 'health'} onClick={() => setActiveTab('health')} />
                </div>
            </div>
        );
        const NavIcon = ({ icon: Icon, active, onClick }) => (
            <button onClick={onClick} className={`transition-all duration-300 ${active ? 'text-brand-primary -translate-y-1' : 'text-brand-muted hover:text-brand-text'}`}>
                <Icon size={26} strokeWidth={active ? 3 : 2.5} />
                {active && <div className="w-1 h-1 bg-brand-primary rounded-full mx-auto mt-1 absolute -bottom-2 left-0 right-0 ml-auto mr-auto"></div>}
            </button>
        );
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<VitaloApp />);
    </script>
</body>
</html>
